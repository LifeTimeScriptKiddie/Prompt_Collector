{
  "data": "\n# MCP Conversion Plan for Time-Series API\n\n## Current State Analysis\n\nThe existing FastAPI application (main.py:240) provides:\n- Three endpoints: /timeseries, /timeseries/aggregate, /metrics\n- Synthetic data generation for CPU, memory, and temperature metrics\n- Pydantic models for data validation\n- Pandas-based time-series processing\n\n## MCP Architecture Design\n\n### 1. MCP Server Component\n\nPurpose: Expose time-series data and analytics capabilities to AI models\n\nCore Capabilities:\n- Resources: Historical time-series data access\n- Tools: Data querying, aggregation, and analysis functions\n- Prompts: Templates for common analytics workflows\n\nStructure:\n\n```python\n# mcp_server.py\nclass TimeSeriesServer:\n    resources = [\n        \"timeseries/{metric}/{start}/{end}\",  # Historical data\n        \"metrics/available\",                   # Metric metadata\n    ]\n\n    tools = [\n        \"query_timeseries\",      # Flexible data querying\n        \"aggregate_data\",        # Statistical aggregations\n        \"detect_anomalies\",      # Basic anomaly detection\n        \"forecast_trend\",        # Simple trend analysis\n      ]\n\n    prompts = [\n        \"analyze_metrics\",       # Guided metric analysis\n        \"compare_periods\",       # Time period comparisons\n        \"generate_report\",       # Automated reporting\n      ]\n```\n\n### 2. MCP Client Component\n\nPurpose: Interface for AI applications to consume time-series services\n\nFeatures:\n- JSON-RPC 2.0 communication over STDIO/HTTP\n- Authentication and authorization handling\n- Resource discovery and tool registration\n- Response caching and optimization\n\n## Data Transformation Strategy\n\nFrom REST to MCP Format:\n\n- REST Query: GET /timeseries?metric=cpu_usage&start_time=2025-01-01\n- MCP Resource: timeseries/cpu_usage/2025-01-01/2025-01-02\n- MCP Tool Call: query_timeseries(metric=\"cpu_usage\", start=\"2025-01-01\")\n\nMessage Format:\n\n```json\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"query_timeseries\",\n    \"arguments\": {\n      \"metric\": \"cpu_usage\",\n      \"start_time\": \"2025-01-01T00:00:00Z\",\n      \"end_time\": \"2025-01-02T00:00:00Z\",\n      \"aggregation\": \"1H\"\n    }\n  }\n}\n```\n\n## Implementation Roadmap\n\n### Phase 1: Core MCP Server (2-3 days)\n\n1. Install MCP Python SDK: pip install mcp\n2. Create mcp_server.py with basic JSON-RPC handling\n3. Migrate data generation logic from main.py:48-80\n4. Implement core tools: query_timeseries, get_metrics\n5. Add STDIO transport support\n\n### Phase 2: Advanced Tools (2-3 days)\n\n1. Implement aggregate_data tool using pandas operations from main.py:166-235\n2. Add detect_anomalies tool with statistical analysis\n3. Create forecast_trend tool with basic time-series prediction\n4. Implement resource endpoints for cached data access\n\n### Phase 3: MCP Client (1-2 days)\n\n1. Create mcp_client.py with JSON-RPC client logic\n2. Add authentication and session management\n3. Implement tool discovery and registration\n4. Add HTTP+SSE transport support for remote servers\n\n### Phase 4: Integration & Testing (1-2 days)\n\n1. Create unified entry point supporting both MCP and legacy REST\n2. Add comprehensive error handling and logging\n3. Write integration tests for client-server communication\n4. Update documentation and usage examples\n\n### Phase 5: Security & Production (1-2 days)\n\n1. Implement OAuth 2.1 authentication for HTTP transport\n2. Add rate limiting and access controls\n3. Security audit for prompt injection vulnerabilities\n4. Performance optimization and caching strategies\n\n## File Structure\n\n```\nts_api/\n├── main.py              # Legacy FastAPI (maintained for compatibility)\n├── mcp_server.py        # MCP server implementation\n├── mcp_client.py        # MCP client implementation  \n├── mcp_tools.py         # Tool implementations\n├── mcp_resources.py     # Resource handlers\n├── requirements.txt     # Updated dependencies\n└── tests/\n├── test_mcp_server.py\n└── test_mcp_client.py\n```\n\n## Key Dependencies\n\n- mcp - Official MCP Python SDK\n- pandas - Time-series data processing (existing)\n- numpy - Numerical operations (existing)\n- pydantic - Data validation (existing)\n- uvicorn - ASGI server (existing)\n\n## Migration Benefits\n\n- Standardized Integration: AI applications can seamlessly access time-series data\n- Enhanced Capabilities: Rich tool ecosystem for analytics beyond simple REST queries\n- Security: Built-in authentication and consent flows\n- Extensibility: Easy addition of new metrics, tools, and analytics capabilities\n- Future-Proof: Compliance with emerging MCP industry standard\n\nThis plan maintains backward compatibility while adding modern MCP capabilities, enabling both traditional REST API usage and advanced AI-driven analytics\nworkflows.\n\n"
}
