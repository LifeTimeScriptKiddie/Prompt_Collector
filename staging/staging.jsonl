={"data":"# CLAUDE.md\n\nThis file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\n\n## Project Overview\n\nThis is a monorepo containing two related security-focused npm packages for hardening markdown against data exfiltration attacks through LLM prompt injection:\n\n1. **harden-react-markdown**: A wrapper for `react-markdown` that filters URLs with configurable allow-lists\n2. **markdown-to-markdown-sanitizer**: A markdown-to-markdown sanitizer for third-party rendering scenarios (GitHub, GitLab)\n\n## Repository Structure\n\n- `harden-react-markdown/`: React wrapper for secure markdown rendering\n- `markdown-to-markdown-sanitizer/`: Standalone markdown sanitizer with comprehensive security testing\n\n## Development Commands\n\nBoth packages use **pnpm** (not npm) as the package manager.\n\n### Root-level Commands\n\n```bash\n# Run tests for both packages\npnpm test\n\n# Run tests for specific package\npnpm run test:harden-react-markdown\npnpm run test:markdown-to-markdown-sanitizer\n```\n\n### harden-react-markdown\n\n```bash\ncd harden-react-markdown\n\n# Build the package\npnpm run build\n\n# Run tests\npnpm test\n\n# Run tests in watch mode\npnpm run test:watch\n\n# Run tests with UI\npnpm run test:ui\n\n# Prepare for publishing (build + test)\npnpm run prepublishOnly\n```\n\n### markdown-to-markdown-sanitizer\n\n```bash\ncd markdown-to-markdown-sanitizer\n\n# Build the package\npnpm run build\n\n# Run all tests\npnpm test\n\n# Run tests in watch mode\npnpm run test:watch\n\n# Run tests with UI\npnpm run test:ui\n\n# Run tests with coverage\npnpm run test:coverage\n\n# Type checking\npnpm run check-types\npnpm run check-types:tests\npnpm run check-types:all\n\n# Linting\npnpm run lint\npnpm run lint:tests\n\n# Run single test file\npnpm test -- tests/basic-sanitization.test.ts\n```\n\n## Architecture Overview\n\n### harden-react-markdown\n\n- **Purpose**: Drop-in replacement for `react-markdown` with URL filtering\n- **Key Features**: URL prefix allow-lists for links and images, relative URL handling\n- **Security**: Blocks dangerous protocols, provides clear blocked content indicators\n\n### markdown-to-markdown-sanitizer\n\n- **Purpose**: Sanitizes markdown intended for third-party rendering\n- **Pipeline**: Markdown → HTML → DOMPurify → Turndown → Entity encoding\n- **Key Components**:\n  - `MarkdownSanitizer`: Main orchestration class\n  - `UrlNormalizer`: URL validation and prefix matching\n  - `HtmlSanitizer`: DOMPurify wrapper with GitHub-compatible rules\n- **Security**: 111+ bypass attempt tests, comprehensive URL validation, HTML entity escaping\n\n## Testing Strategy\n\nBoth packages share the tests based on markdown-to-markdown-sanitizer/tests/bypass-attempts/\\*.md.\nAdding more examples hardens both packages\n\n### harden-react-markdown\n\n- Basic component functionality tests\n- URL filtering validation\n- Security bypass prevention\n- TypeScript type safety\n\n### markdown-to-markdown-sanitizer\n\n- **Bypass Testing**: 111 adversarial markdown files in `tests/bypass-attempts/`\n- **Multi-Parser Testing**: Tests against 5 different markdown parsers (remark, marked, markdown-it, showdown, commonmark)\n- **Comprehensive Coverage**: 800+ tests covering sanitization, HTML processing, edge cases\n- **Security Focus**: XSS prevention, protocol smuggling, encoding bypass attempts\n\n## Security Considerations\n\nBoth packages are designed for **defensive security use only**:\n\n- URL allow-listing to prevent data exfiltration\n- XSS prevention through HTML sanitization\n- Protocol filtering (javascript:, data:, etc.)\n- Comprehensive bypass attempt testing\n\n## Key Implementation Notes\n\n### URL Normalization\n\n- Uses browser URL constructor for parsing\n- Supports protocol-only, domain, and path prefixes\n- Encodes markdown-dangerous characters as percent-encoded\n- Replaces invalid hrefs with `#`, removes invalid src attributes\n\n### HTML Sanitization (markdown-to-markdown-sanitizer)\n\n- DOMPurify with GitHub-compatible allow-lists\n- Supports advanced HTML elements (details, tables, ruby)\n- Prefixes user-generated IDs with `user-content-`\n- Aggressive character-to-entity encoding for dangerous characters\n\n### Performance\n\n- Configurable length limits prevent DoS attacks\n- Efficient markdown-to-HTML-to-markdown pipeline\n- Character-by-character parsing avoids regex catastrophic backtracking\n"}