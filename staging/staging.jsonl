={
  "data": "# Operative - Developer Documentation\n\n## Project Overview\n\nOperative is a reference implementation for Claude's computer use capabilities. It enables Claude to interact with a computer environment through a set of tools, providing the following features:\n\n- A Docker container with all necessary dependencies\n- An agent loop using Anthropic API, Bedrock, or Vertex to access Claude 3.5/3.7 Sonnet\n- Implementation of Anthropic-defined computer use tools\n- A Streamlit app for user interaction with the agent\n\n## Architecture\n\n### Core Components\n\n1. **Main Modules**\n   - `operative.py`: Entrypoint and Streamlit UI interface\n   - `loop.py`: Agent sampling loop for Claude API interaction\n   - `prompt.py`: System prompt for Claude with tool instructions\n   - `tools/`: Tool implementations for computer interaction\n\n2. **Tool Structure**\n   - `tools/base.py`: Base tool classes and common functionality\n   - `tools/computer.py`: Screen, keyboard, and mouse interaction\n   - `tools/bash.py`: Shell command execution\n   - `tools/edit.py`: File editing capabilities\n   - `tools/collection.py`: Tool collection management\n   - `tools/groups.py`: Tool versioning and grouping\n\n3. **API Support**\n   - Anthropic API (direct)\n   - AWS Bedrock\n   - Google Vertex AI\n\n4. **Container Components**\n   - X11 environment with Xvfb\n   - Lightweight desktop environment (tint2)\n   - VNC server for remote viewing\n   - Web interface combining Streamlit and desktop view\n\n### Data Flow\n\n1. User inputs instructions via Streamlit interface\n2. Instructions are sent to Claude via the API\n3. Claude generates response, potentially including tool calls\n4. Tool calls are executed in the container environment\n5. Results (including screenshots) are returned to Claude\n6. Claude interprets results and continues the interaction\n\n## Implementation Details\n\n### Tool Versions\n\nThe project supports two tool versions:\n- `computer_use_20241022`: Initial version for Claude 3.5 Sonnet\n- `computer_use_20250124`: Enhanced version for Claude 3.7 Sonnet with additional actions\n\n### Computer Tool\n\nThe computer tool allows Claude to:\n- Take screenshots of the display\n- Move the mouse cursor\n- Perform mouse clicks (left, right, middle, double)\n- Type text or send key combinations\n- Drag items with the mouse\n- Get cursor position\n\nThe newer version adds features like:\n- Mouse down/up actions for more complex interactions\n- Scrolling capability\n- Key holding\n- Waiting (pausing) for interface elements\n- Triple-click actions\n\n### Screen Resolution Handling\n\nThe implementation includes scaling logic to handle different screen resolutions:\n- XGA/WXGA resolutions are recommended for optimal performance\n- Coordinates can be scaled between the actual screen size and the optimal size\n- Image scaling is performed to provide Claude with appropriately sized screenshots\n\n### Thinking Capability\n\nClaude 3.7 Sonnet supports a \"thinking\" capability that allows for more detailed reasoning:\n- Enabled via the `thinking_budget` parameter\n- Thinking content is displayed in a separate tab in the UI\n- Streaming of thinking content for real-time feedback\n\n### Token Efficiency\n\nSeveral optimizations are implemented to manage token usage:\n- Limiting the number of recent screenshots sent to the model\n- Optional token-efficient tools beta flag\n- Prompt caching to reduce token consumption for repetitive elements\n\n## Development Environment\n\n### Requirements\n\n- Python 3.13+\n- Docker\n- uv (Python packaging tool)\n\n### Setup\n\nThe project uses `uv` for dependency management and virtual environments:\n\n```bash\n# Set up development environment\n./setup.sh  # Configure venv, install dependencies, and set up pre-commit hooks\n\n# Alternatively, use the Makefile\nmake setup  # Set up Python environment with uv\nmake install-dev  # Install development dependencies\n```\n\n### Available Make Commands\n\n```bash\n# Development\nmake dev      # Run with local code mounted\nmake run      # Run locally using uv\n\n# Docker operations\nmake build    # Build the Docker image\nmake push     # Push the Docker image to registry\nmake run-docker  # Run the Docker container\n\n# Testing\nmake test     # Run tests\nmake test-cov # Run tests with coverage\nmake lint     # Run linting\nmake format   # Format code\n```\n\n## Testing Framework\n\nThe project uses pytest with asyncio support for testing asynchronous code:\n\n```bash\n# Run all tests\nmake test\n\n# Run tests with coverage\nmake test-cov\n```\n\nTest files mirror the project structure:\n- `tests/loop_test.py`: Tests for the agent loop\n- `tests/tools/*.py`: Tests for individual tools\n\nTesting approach:\n- Mock objects for simulating API responses\n- AsyncMock for asynchronous function testing\n- Parametrized fixtures for testing multiple implementations\n- Isolated tests for each tool function\n\n## Docker Container\n\nThe container is based on Ubuntu 22.04 and includes:\n\n### Desktop Environment\n- Xvfb for headless operation\n- tint2 as a lightweight desktop environment\n- mutter for window management\n- x11vnc for VNC access\n\n### Development Tools\n- Languages: Python, Node.js, Go, Rust, PHP, .NET, R, Ruby, Scala, Dart, Julia, Zig, Java\n- Editors: VS Code, Neovim, Emacs with Spacemacs\n- Terminal tools: ripgrep, fd-find, jq, fzf, bat, tmux, glow, curlie\n- Databases: SQLite, PostgreSQL, MariaDB, MongoDB, Redis\n- ML libraries: PyTorch, NumPy, Pandas, Scikit-learn, JupyterLab\n\n### GUI Applications\n- Browsers: Firefox ESR, Chromium\n- Office: LibreOffice\n- Text editors: Gedit\n- File manager: PCManFM\n- Utilities: Galculator, Xpaint\n\n### Container Options\n\nThe project provides multiple Docker image variations:\n- `Dockerfile`: Base image with minimal dependencies\n- `Dockerfile.desktop`: Full desktop environment\n- `Dockerfile.xvfb`: Headless environment with Xvfb\n\n## API Integration\n\n### Anthropic API\n\nThe project uses the AsyncAnthropic client for communication with the Anthropic API, supporting:\n- Streamed responses for real-time feedback\n- Beta features for computer use\n- Prompt caching for optimization\n- Support for extended output tokens (128K) with Claude 3.7\n\n### Authentication\n\nDifferent authentication methods are supported depending on the API provider:\n- Anthropic: API key\n- Bedrock: AWS credentials (profile or access keys)\n- Vertex: Google Cloud credentials\n\n## MCP Servers\n\nMCP (Model Context Protocol) servers extend Claude's capabilities. The container includes:\n- hanzo-dev-mcp: Primary MCP server\n- modelcontextprotocol-server-filesystem: File access\n- modelcontextprotocol-server-git: Git operations\n- mcp-server-commands: Shell command execution\n- mcp-text-editor: Text editing\n\n## CI/CD\n\nThe project uses GitHub Actions for CI/CD:\n\n### Workflows\n- `tests.yml`: Runs tests and linting on push to main and pull requests\n- `release.yml`: Builds and publishes Docker images\n\n### Testing Process\n1. Checkout code\n2. Set up Python 3.13\n3. Install dependencies with uv\n4. Run tests with pytest\n5. Run linting with ruff\n\n## Security Considerations\n\nComputer use capabilities introduce unique security risks:\n- The container provides isolation from the host system\n- Warning messages remind users about potential risks\n- Interaction with web content requires caution due to potential prompt injection\n- The implementation recommends limiting internet access and sensitive data exposure\n\n## Debugging and Monitoring\n\nThe UI provides several debugging features:\n- HTTP Logs tab to monitor API requests and responses\n- Thinking Logs tab to track Claude's reasoning\n- Tool outputs displayed inline in the conversation\n- Error messages from tool execution shown in the UI\n\n## Common Issues and Solutions\n\n### Screen Resolution Problems\n- Set `WIDTH` and `HEIGHT` environment variables to match your needs\n- Enable scaling for better model performance with high resolutions\n- Use standard resolutions (XGA/WXGA) for optimal model interaction\n\n### Authentication Issues\n- For Anthropic: Check API key validity and quotas\n- For Bedrock: Verify AWS credentials and region\n- For Vertex: Check GCP credentials and project access\n\n### Tool Execution Failures\n- Check container logs for Xvfb or X11 errors\n- Verify command permissions within the container\n- Check for missing dependencies for specific actions\n"
}
